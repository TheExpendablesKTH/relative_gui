{"ast":null,"code":"\"use strict\"; // Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst ua_parser_js_1 = require(\"ua-parser-js\");\n\nconst Versioning_1 = require(\"../versioning/Versioning\");\n\nclass DefaultEventController {\n  constructor(audioVideoController) {\n    var _a, _b, _c, _d, _e, _f, _g;\n\n    this.audioVideoController = audioVideoController;\n    /** @internal */\n\n    this.meetingHistoryStates = [];\n\n    try {\n      this.parserResult = navigator && navigator.userAgent ? new ua_parser_js_1.UAParser(navigator.userAgent).getResult() : null;\n    } catch (error) {\n      audioVideoController.logger.error(error.message);\n    }\n\n    this.browserMajorVersion = ((_c = (_b = (_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.browser) === null || _b === void 0 ? void 0 : _b.version) === null || _c === void 0 ? void 0 : _c.split('.')[0]) || DefaultEventController.UNAVAILABLE;\n    this.browserName = ((_d = this.parserResult) === null || _d === void 0 ? void 0 : _d.browser.name) || DefaultEventController.UNAVAILABLE;\n    this.browserVersion = ((_e = this.parserResult) === null || _e === void 0 ? void 0 : _e.browser.version) || DefaultEventController.UNAVAILABLE;\n    this.deviceName = [((_f = this.parserResult) === null || _f === void 0 ? void 0 : _f.device.vendor) || '', ((_g = this.parserResult) === null || _g === void 0 ? void 0 : _g.device.model) || ''].join(' ').trim() || DefaultEventController.UNAVAILABLE;\n  }\n\n  publishEvent(name, attributes) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const timestampMs = Date.now();\n      yield this.pushMeetingState(name, timestampMs); // Make a single frozen copy of the event, reusing the object returned by\n      // `getAttributes` to avoid copying too much.\n\n      const eventAttributes = Object.freeze(Object.assign(this.getAttributes(timestampMs), attributes));\n      this.audioVideoController.forEachObserver(observer => {\n        if (observer.eventDidReceive) {\n          observer.eventDidReceive(name, eventAttributes);\n        }\n      });\n    });\n  }\n\n  pushMeetingState(state, timestampMs = Date.now()) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.meetingHistoryStates.push({\n        name: state,\n        timestampMs\n      });\n    });\n  }\n\n  getAttributes(timestampMs) {\n    var _a, _b;\n\n    return {\n      attendeeId: this.audioVideoController.configuration.credentials.attendeeId,\n      browserMajorVersion: this.browserMajorVersion,\n      browserName: this.browserName,\n      browserVersion: this.browserVersion,\n      deviceName: this.deviceName,\n      externalMeetingId: typeof this.audioVideoController.configuration.externalMeetingId === 'string' ? this.audioVideoController.configuration.externalMeetingId : '',\n      externalUserId: this.audioVideoController.configuration.credentials.externalUserId,\n      meetingHistory: this.meetingHistoryStates,\n      meetingId: this.audioVideoController.configuration.meetingId,\n      osName: ((_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.os.name) || DefaultEventController.UNAVAILABLE,\n      osVersion: ((_b = this.parserResult) === null || _b === void 0 ? void 0 : _b.os.version) || DefaultEventController.UNAVAILABLE,\n      sdkVersion: Versioning_1.default.sdkVersion,\n      sdkName: Versioning_1.default.sdkName,\n      timestampMs\n    };\n  }\n\n}\n\nexports.default = DefaultEventController;\n/** @internal */\n\nDefaultEventController.UNAVAILABLE = 'Unavailable';","map":{"version":3,"sources":["../../src/eventcontroller/DefaultEventController.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ua_parser_js_1 = require(\"ua-parser-js\");\nconst Versioning_1 = require(\"../versioning/Versioning\");\nclass DefaultEventController {\n    constructor(audioVideoController) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        this.audioVideoController = audioVideoController;\n        /** @internal */\n        this.meetingHistoryStates = [];\n        try {\n            this.parserResult =\n                navigator && navigator.userAgent ? new ua_parser_js_1.UAParser(navigator.userAgent).getResult() : null;\n        }\n        catch (error) {\n            audioVideoController.logger.error(error.message);\n        }\n        this.browserMajorVersion =\n            ((_c = (_b = (_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.browser) === null || _b === void 0 ? void 0 : _b.version) === null || _c === void 0 ? void 0 : _c.split('.')[0]) || DefaultEventController.UNAVAILABLE;\n        this.browserName = ((_d = this.parserResult) === null || _d === void 0 ? void 0 : _d.browser.name) || DefaultEventController.UNAVAILABLE;\n        this.browserVersion = ((_e = this.parserResult) === null || _e === void 0 ? void 0 : _e.browser.version) || DefaultEventController.UNAVAILABLE;\n        this.deviceName =\n            [((_f = this.parserResult) === null || _f === void 0 ? void 0 : _f.device.vendor) || '', ((_g = this.parserResult) === null || _g === void 0 ? void 0 : _g.device.model) || '']\n                .join(' ')\n                .trim() || DefaultEventController.UNAVAILABLE;\n    }\n    publishEvent(name, attributes) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const timestampMs = Date.now();\n            yield this.pushMeetingState(name, timestampMs);\n            // Make a single frozen copy of the event, reusing the object returned by\n            // `getAttributes` to avoid copying too much.\n            const eventAttributes = Object.freeze(Object.assign(this.getAttributes(timestampMs), attributes));\n            this.audioVideoController.forEachObserver((observer) => {\n                if (observer.eventDidReceive) {\n                    observer.eventDidReceive(name, eventAttributes);\n                }\n            });\n        });\n    }\n    pushMeetingState(state, timestampMs = Date.now()) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.meetingHistoryStates.push({\n                name: state,\n                timestampMs,\n            });\n        });\n    }\n    getAttributes(timestampMs) {\n        var _a, _b;\n        return {\n            attendeeId: this.audioVideoController.configuration.credentials.attendeeId,\n            browserMajorVersion: this.browserMajorVersion,\n            browserName: this.browserName,\n            browserVersion: this.browserVersion,\n            deviceName: this.deviceName,\n            externalMeetingId: typeof this.audioVideoController.configuration.externalMeetingId === 'string'\n                ? this.audioVideoController.configuration.externalMeetingId\n                : '',\n            externalUserId: this.audioVideoController.configuration.credentials.externalUserId,\n            meetingHistory: this.meetingHistoryStates,\n            meetingId: this.audioVideoController.configuration.meetingId,\n            osName: ((_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.os.name) || DefaultEventController.UNAVAILABLE,\n            osVersion: ((_b = this.parserResult) === null || _b === void 0 ? void 0 : _b.os.version) || DefaultEventController.UNAVAILABLE,\n            sdkVersion: Versioning_1.default.sdkVersion,\n            sdkName: Versioning_1.default.sdkName,\n            timestampMs,\n        };\n    }\n}\nexports.default = DefaultEventController;\n/** @internal */\nDefaultEventController.UNAVAILABLE = 'Unavailable';\n//# sourceMappingURL=DefaultEventController.js.map"]},"metadata":{},"sourceType":"script"}