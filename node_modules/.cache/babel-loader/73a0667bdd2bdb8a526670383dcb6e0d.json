{"ast":null,"code":"\"use strict\"; // Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst Versioning_1 = require(\"../versioning/Versioning\");\n\nconst WebSocketReadyState_1 = require(\"./WebSocketReadyState\");\n\nclass DefaultWebSocketAdapter {\n  constructor(logger) {\n    this.logger = logger;\n  }\n\n  create(url, protocols, isSignedUrl) {\n    this.connection = new WebSocket(isSignedUrl ? url : Versioning_1.default.urlWithVersion(url), protocols);\n    this.connection.binaryType = 'arraybuffer';\n  }\n\n  send(message) {\n    try {\n      if (message instanceof Uint8Array) {\n        this.connection.send(message.buffer);\n      } else {\n        this.connection.send(message);\n      }\n\n      return true;\n    } catch (err) {\n      this.logger.debug(() => `send error: ${err.message}, websocket state=${WebSocketReadyState_1.default[this.readyState()]}`);\n      return false;\n    }\n  }\n\n  close(code, reason) {\n    this.connection.close(code, reason);\n  }\n\n  destroy() {\n    this.connection = null;\n  }\n\n  addEventListener(handler, eventListener) {\n    this.connection.addEventListener(handler, eventListener);\n  }\n\n  readyState() {\n    if (!this.connection) {\n      return WebSocketReadyState_1.default.None;\n    }\n\n    switch (this.connection.readyState) {\n      case WebSocket.CONNECTING:\n        return WebSocketReadyState_1.default.Connecting;\n\n      case WebSocket.OPEN:\n        return WebSocketReadyState_1.default.Open;\n\n      case WebSocket.CLOSING:\n        return WebSocketReadyState_1.default.Closing;\n\n      case WebSocket.CLOSED:\n        return WebSocketReadyState_1.default.Closed;\n    }\n  }\n\n}\n\nexports.default = DefaultWebSocketAdapter;","map":{"version":3,"sources":["../../src/websocketadapter/DefaultWebSocketAdapter.ts"],"names":[],"mappings":"cAAA;AACA;;;;;;AAGA,MAAA,YAAA,GAAA,OAAA,CAAA,0BAAA,CAAA;;AAEA,MAAA,qBAAA,GAAA,OAAA,CAAA,uBAAA,CAAA;;AAEA,MAAqB,uBAArB,CAA4C;AAG1C,EAAA,WAAA,CAAoB,MAApB,EAAkC;AAAd,SAAA,MAAA,GAAA,MAAA;AAAkB;;AAEtC,EAAA,MAAM,CAAC,GAAD,EAAc,SAAd,EAAmC,WAAnC,EAAwD;AAC5D,SAAK,UAAL,GAAkB,IAAI,SAAJ,CAAc,WAAW,GAAG,GAAH,GAAS,YAAA,CAAA,OAAA,CAAW,cAAX,CAA0B,GAA1B,CAAlC,EAAkE,SAAlE,CAAlB;AACA,SAAK,UAAL,CAAgB,UAAhB,GAA6B,aAA7B;AACD;;AAED,EAAA,IAAI,CAAC,OAAD,EAA6B;AAC/B,QAAI;AACF,UAAI,OAAO,YAAY,UAAvB,EAAmC;AACjC,aAAK,UAAL,CAAgB,IAAhB,CAAqB,OAAO,CAAC,MAA7B;AACD,OAFD,MAEO;AACL,aAAK,UAAL,CAAgB,IAAhB,CAAqB,OAArB;AACD;;AACD,aAAO,IAAP;AACD,KAPD,CAOE,OAAO,GAAP,EAAY;AACZ,WAAK,MAAL,CAAY,KAAZ,CACE,MACE,eAAe,GAAG,CAAC,OAAO,qBAAqB,qBAAA,CAAA,OAAA,CAAoB,KAAK,UAAL,EAApB,CAAsC,EAFzF;AAIA,aAAO,KAAP;AACD;AACF;;AAED,EAAA,KAAK,CAAC,IAAD,EAAgB,MAAhB,EAA+B;AAClC,SAAK,UAAL,CAAgB,KAAhB,CAAsB,IAAtB,EAA4B,MAA5B;AACD;;AAED,EAAA,OAAO,GAAA;AACL,SAAK,UAAL,GAAkB,IAAlB;AACD;;AAED,EAAA,gBAAgB,CAAC,OAAD,EAAkB,aAAlB,EAA8C;AAC5D,SAAK,UAAL,CAAgB,gBAAhB,CAAiC,OAAjC,EAA0C,aAA1C;AACD;;AAED,EAAA,UAAU,GAAA;AACR,QAAI,CAAC,KAAK,UAAV,EAAsB;AACpB,aAAO,qBAAA,CAAA,OAAA,CAAoB,IAA3B;AACD;;AACD,YAAQ,KAAK,UAAL,CAAgB,UAAxB;AACE,WAAK,SAAS,CAAC,UAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,UAA3B;;AACF,WAAK,SAAS,CAAC,IAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,IAA3B;;AACF,WAAK,SAAS,CAAC,OAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,OAA3B;;AACF,WAAK,SAAS,CAAC,MAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,MAA3B;AARJ;AAUD;;AArDyC;;AAA5C,OAAA,CAAA,OAAA,GAAA,uBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Versioning_1 = require(\"../versioning/Versioning\");\nconst WebSocketReadyState_1 = require(\"./WebSocketReadyState\");\nclass DefaultWebSocketAdapter {\n    constructor(logger) {\n        this.logger = logger;\n    }\n    create(url, protocols, isSignedUrl) {\n        this.connection = new WebSocket(isSignedUrl ? url : Versioning_1.default.urlWithVersion(url), protocols);\n        this.connection.binaryType = 'arraybuffer';\n    }\n    send(message) {\n        try {\n            if (message instanceof Uint8Array) {\n                this.connection.send(message.buffer);\n            }\n            else {\n                this.connection.send(message);\n            }\n            return true;\n        }\n        catch (err) {\n            this.logger.debug(() => `send error: ${err.message}, websocket state=${WebSocketReadyState_1.default[this.readyState()]}`);\n            return false;\n        }\n    }\n    close(code, reason) {\n        this.connection.close(code, reason);\n    }\n    destroy() {\n        this.connection = null;\n    }\n    addEventListener(handler, eventListener) {\n        this.connection.addEventListener(handler, eventListener);\n    }\n    readyState() {\n        if (!this.connection) {\n            return WebSocketReadyState_1.default.None;\n        }\n        switch (this.connection.readyState) {\n            case WebSocket.CONNECTING:\n                return WebSocketReadyState_1.default.Connecting;\n            case WebSocket.OPEN:\n                return WebSocketReadyState_1.default.Open;\n            case WebSocket.CLOSING:\n                return WebSocketReadyState_1.default.Closing;\n            case WebSocket.CLOSED:\n                return WebSocketReadyState_1.default.Closed;\n        }\n    }\n}\nexports.default = DefaultWebSocketAdapter;\n//# sourceMappingURL=DefaultWebSocketAdapter.js.map"]},"metadata":{},"sourceType":"script"}